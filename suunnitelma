SELECT T.haltija, MAX((SELECT SUM(B.muutos) FROM Tapahtumat A, Tapahtumat B WHERE T.id=A.tili_id AND T.id=B.tili_id AND A.id<=B.id))
FROM Tapahtumat Ta LEFT JOIN Tilit T ON T.id=Ta.tili_id
GROUP BY T.id;


SELECT SUM(B.muutos)
FROM Tapahtumat A, Tapahtumat B, Tilit Ti
WHERE Ti.id=A.tili_id AND Ti.haltija='Uolevi' AND B.id <= A.id AND B.tili_id=A.tili_id
GROUP BY A.id;

SELECT T.haltija, MAX((SELECT SUM(B.muutos) FROM Tapahtumat A, Tapahtumat B WHERE T.id=A.tili_id AND T.id=B.tili_id AND B.id<=A.id GROUP BY A.id))
FROM Tilit T;






